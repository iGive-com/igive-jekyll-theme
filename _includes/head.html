<head>
    <meta charset="UTF-8">

    {% if jekyll.environment == "production" %}
    <!-- Google Tag Manager -->
    <script>
        (function (w, d, s, l, i) {
            w[l] = w[l] || [];
            w[l].push({'gtm.start': new Date().getTime(), event: 'gtm.js'});
            var f = d.getElementsByTagName(s)[0],
                j = d.createElement(s),
                dl = l != 'dataLayer'
                    ? '&l=' + l
                    : '';
            j.async = true;
            j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
            f
                .parentNode
                .insertBefore(j, f);
        })(window, document, 'script', 'dataLayer', '{{ site.gtm }}');
    </script>
    <!-- End Google Tag Manager -->
    {% endif %}

    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="google-site-verification" content=""/>

    <title>
        {% if page.title and page.title != 'Home' %}{{ page.title }} | {% endif %}{{ site.title }}</title>
    {% assign pagecontent_description = page.content | markdownify | replace : '.',
    '. ' | replace : '</h2>',
    ': ' | replace : '</h3>',
    ': ' | replace : '</h4>',
    ': ' | strip_html | strip_newlines | replace : '  ',
    ' ' | truncate : 160 %}
    <meta name="description" content="{% if page.description %}{{ page.description }}{% elsif pagecontent_description.size > 10 %}{{ pagecontent_description }}{% else %}{{ site.description }}{% endif %}">

    <!-- PWA -->
    <link rel="apple-touch-icon" sizes="180x180" href="{{ '/assets/pwa/apple-touch-icon.png' | absolute_url }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ '/assets/pwa/favicon-32x32.png' | absolute_url }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ '/assets/pwa/favicon-16x16.png' | absolute_url }}">
    <link rel="manifest" href="{{ '/assets/pwa/site.webmanifest' | absolute_url }}">
    <link rel="mask-icon" href="{{ '/assets/pwa/safari-pinned-tab.svg' | absolute_url }}" color="#ea8900">
    <meta name="apple-mobile-web-app-title" content="iGive.com">
    <meta name="application-name" content="iGive.com">
    <meta name="msapplication-TileColor" content="#ea8900">
    <meta name="theme-color" content="#ffffff">

    <!-- Facebook integration -->
    <meta property="og:title" content="{{ page.title }}"/>
    <meta property="og:url" content="{{ page.url | absolute_url }}"/>
    <meta property="og:type" content="{% if page.layout == 'post' %}article{% elsif page.layout == 'page' %}page{% else %}website{% endif %}">
    <meta property="og:site_name" content="{{ site.title }}"/>
    <meta property="og:description" content="{% if page.description %}{{ page.description }}{% elsif pagecontent_description.size > 10 %}{{ pagecontent_description }}{% else %}{{ site.description }}{% endif %}"/>
    <meta property="og:image" content="{{ page.image | default: '/assets/images/og_image.png' | absolute_url }}"/>

    <!-- Twitter integration -->
    <meta name="twitter:card" content="summary">
    {% if site.twitter_username %}<meta name="twitter:site" content="https://www.twitter.com/{{ site.twitter_username }}">{% endif %}
    <meta name="twitter:title" content="{{ page.title }}"/>
    <meta name="twitter:image" content="{{ page.image | default: '/assets/images/og_image.png' | absolute_url }}"/>
    <meta name="twitter:url" content="{{ page.url | absolute_url }}"/>
    <meta name="twitter:description" content="{% if page.description %}{{ page.description }}{% elsif pagecontent_description.size > 10 %}{{ pagecontent_description }}{% else %}{{ site.description }}{% endif %}"/>

    <link rel="canonical" href="{{ page.url | replace:'index.html','' | absolute_url }}">
    <link rel="alternate" type="application/rss+xml" title="{{ site.title }}" href="{{ 'feed.xml' | absolute_url }}">
    <link rel="sitemap" type="application/xml" title="Sitemap" href="{{ 'sitemap.xml' | absolute_url }}"/>

    <!-- Styles -->
    <link rel="stylesheet" href="{{ '/assets/css/main.css' | absolute_url }}">
    <link href="{{ '/assets/fontawesome/css/fontawesome.css' | absolute_url }}" rel="stylesheet" />
    <link href="{{ '/assets/fontawesome/css/brands.css' | absolute_url }}" rel="stylesheet" />
    <link href="{{ '/assets/fontawesome/css/solid.css' | absolute_url }}" rel="stylesheet" />

    <!-- Head Scripts -->
    <script src="{{ '/assets/js/jquery.min.js' | absolute_url }}"></script>
    <script>
        /* Redirect to search page with ?q= query for PageFind results */
        function getParameterByName(name, url = window.location.href) {
            name = name.replace(/[\[\]]/g, "\\$&");
            var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
                results = regex.exec(url);
            if (!results) 
                return null;
            if (!results[2]) 
                return "";
            return decodeURIComponent(results[2].replace(/\+/g, " "));
        }

        {% if jekyll.environment == "development" %}
        /* Crisp Chatbot */
        window.$crisp = [];
        window.CRISP_WEBSITE_ID = "520aa220-9642-49ba-81ac-1a46eef47fc2";
        (function () {
            d = document;
            s = d.createElement("script");
            s.src = "https://client.crisp.chat/l.js";
            s.async = 1;
            d
                .getElementsByTagName("head")[0]
                .appendChild(s);
        })();
        {% endif %}

        /* PWA Service Worker */
        if ('serviceWorker' in navigator) {
            /* Wait until window is loaded before registering. */
            window.addEventListener('load', () => {
                /* Register the service worker with "/" as it's scope. */
                navigator
                    .serviceWorker
                    .register('assets/pwa/sw.js', {scope: '/'})
                    /* Output success/failure of registration. */
                    .then(() => console.log('SW registered'))
                    .catch(() => console.error('SW registration failed'));
            });
        }
    </script>
</head>